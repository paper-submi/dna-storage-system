#include <gtest/gtest.h>
#include <fstream>
#include "../../DataStructure/Cluster.h"

TEST(ClusterView, AddRead) {

    ClustersDataset dataset;
    Cluster reads;
    ClusterView cluster;

    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGATCTCGCCGAAGTATTTGCCGAATGACCAGCATCAACATGGGAACGCTACCCCACCACCGAGAGCCAGGAGTTCCTGAGGAGTGCCGAGCCATAATGGTGAATAAGAGCCGTCTGGATAGGAACTCAATTCTTACTGCGCTCCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTACACGATGACCGCACGTTGCAACCATTAAACAGAGACCTAGTTCCGTCCCGCCTCGCATGACGCCAGATATAGGTGTGCGGTTGCTCACCTGGCTCACAGCAAGCGCACCTTCATCGTATCGAGGCCGAAGGTCGATATGGGCTCAATTCACAAGCACGGAGGCGGTACCTAGAACTGTGTAACATCGCAAGATCACGGACTCTGCGTACCGTTAGTACTAGATACGCCGTGTTGAATAGGGCTGCAGCTAAGTCTCATGCCATGTTAGTATGCTGGACGCCGTTACCAGCCTGATGGCATTATCGATATGCGTGGTTCAGACGCCGTGGATTAAGGCCTCATCCGAACGAGCAGACACAAGATACACATGCCGGCTAAGACTCTGCAAGAGCCTCGCCGTTGAAGTCGTAATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGAAACTGTATCAGAGTCTATACTTCAAGCGGCGAAAGACGAAAAGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACATGTGCTTCGCTTCAGGCACCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTTCGTACGATACATCGCCGGTGTAAGAACTCTCCGAAGTATTGCCGAATGACCAGCATCAACATGGGAACGCTACGCCACCACACGAGAGCCAGAAGTTGCGTGAGAGTGCCGAGCCACAATGGTAAAAAGAGCCGTCGGACTGGCACTCAATTCTTACTGCGACTTCTGTCAATGCGGCCGTAGGCCGCGTATACGACCACGCGCTCTACAGCCATCCGCAAGTTGCACCATTTTCAAGACCTATGTTCCGTCCAGCCTCGCATGACGCCAGATAAGGTGTGCGTTGCTCACCGGCTCACAGCAAGCGCACCTCATCTTCGAGGCCGAAGGTCGATATGCGGCCAATACAGGACGGAGGCGGTACCTAGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTTAGTACTGAAACGCCGTGTCGAATATGGCGGCCAGCTAAGTCTCGATGCCATGTTCGTATGCTTGGACGCCGTTACCAGCCCTATGCATATCGATATGCTGATATCAGACGCTCGGGATTAAGCCTCATCCGAACGGCAGCCACGGCTACACATGCCGGCAAACTCTGCAAGGCAGACTCGCCGTTGAAGTCTCAATTACTGCCGTCAGGTGATGAGAGCATGAGGAAGCTCGTGGTTCGACACTTGTATCAGAGTCTATACTTCTAACGGTCGAGAGACGAGAGGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACAGTGTGGTCTTGCTTCAGGCAACTGCTGCGCAATACAAATTCCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACTGATACATCCGCCGCTGTAAGACTCGCCGAAAGTATTGCCGAATGACCAGCATCAACTGGAACGCTACCCACACACGAGAGCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAGCCGTCGATGGAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGTCATACGACCACGCGCTCTAGACCATGACCGCACGTGTGCAACCATTATTCAAGACCTGTGTTCGTCCAGCCTCGCATGACGACCAGATAAGGTGTTGCGGTTGCTCACCGGCTCACAGCAAGCGCACCTTCATCTATCAGGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGACCTAGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTAGTACTAGATACGCCGGTGTGGAATATGGCGGCCAGCTAAGTCTCATGCCATGCTAGTATGCTTGGAGCCGTTACCCAGCCTGATGCATTATCGATATCCTGATTCAGACCCGTGGCATTAAGGCCTCATCCGATCGGCAACACAGATACCATGCCGGCTAAGACTCTGCAAGGAGAATCGCCGTTGAAGTCTCTATTCTACCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCAACAACTTGTGTCAGAGTCTATCTTCAACGGCGTGAACGAGAAGGTTGCAGTCCTGAGATGCGGCTTGCTAGCATTACATGTGTCTTGCTTCAGGCACCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACGGATTAGTACGATACATCCGCCGCTGTAAGACTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAACGCGTACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGACGCCACATATGGTGAATAAGAGCCGTCGGATGGAATCTCAATTCTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTGCACCATGACCGCACGTTGCAACCATTGTTCAAGACCTATGTTCCGTCCAGCCTCCCATGACGCCAGATAAGGTGTGCGTTGCTCCCGGCTCACAGCAAGCGCACCTTCATCTATCGAGGCCGAAGGTCGATATGCGGCTTAATTCACAGGACGGAGGCGTTACCTAGATACTGTGTAGAACACGCAAGGATCCGGATCTGACGTCCCGTTAGTACTAGGTACGCCGTGTGGAATATGGCGGCCAGCTAAGTCTCTTGGCCATGTTAGTATGCTTGGACGCCGTATACCAGCCTGATGCATTATCGATATGCATGATTCAGACGCCGTGGATTAAGGCCTTATCCGAGACGGCAGACAGAGATACACATGCCGGCTAAGACTCTGGAAGGAGACTCGCCTTGAAGCCTCATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTCTATCAGAGTTATACTTCAACGGGCGAGAGACGAGAAGGTTGGGTACCTGAGATGCGCTTGCTCGCATTACATGTGTCTTGCTTCAGGCACCTGCGCGCAATACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATATCTGGAATTAGTCCGATACATCCGCCGCTGTATAGACTCGCCGAAGATTCCGAATGACCAGCATCAACATGGAACGCTACGCCACCACAGACGAGAGCCAGAAGTTCCTGAGGAGCGCCGAGCCACAATGCTGAATAAGGCCGTCGGATGGAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCCCGCGCTCTACACCATGATGCACGTATGCAACCATTATTCAAGCCTCTGTTCCGTCCAGCCTCGCATGACGCCAGATAATGTGTGGGTTGCTCACCGGCTCACAGGAAGCGCACCTTGCATCTTCGAGGCCGATAGGATCGATTGCGGCTCAATTCACAGGACGGAGGGGGTACCTAGATACTGTGTAGGAACATCGCAAGGATCACGGATCTGTCGTACCCGTTAGTACTAGATATCCGTGTGGAATATGGTGGCCAGCTAAGTCTCGTGCCAGTTAGTATGCTTGGACGCCGTTACCAGCCTGATGCATTATCGATATGCTGATTCAGACTCCGTGGATTAAGTCCCATCCGAACGGCAGACACAGATAACGTGCCGGCTCAGACTCTGCAAGGAGACTCGCCGTTGAAATCCATTACTGACGTCAGGTTGATAAGACATGAGGAAGCTCGTAGATTCGACAACTTGTATAGAGTCTATACTTCAACGGACGAGAGACGAGAAGGTTGCGGTCCAGACATGCAGCTTGCTAGCATACATGTGTCTTGCTTCAGGCACCTGCCGCAATATACAATTCAAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGACGATACATCCGCCCCTGTAGACTCGCCGAAGTATTGCCGAATGACCGCATCAACATGGAACGCTACGCCACACACGGGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAACCGTCGGGTGGAACTCAATTCTTACTGCGGACTTCTGTCAATGCGAGCCGAGAGTCGGCATACGACCACGCGCTCTACACCATAACCTGCACGTTGCAACCATTATTCAAGCACCTATGTTCCGCCAGCCTCGCTTGACGCCGAATAAGGTGTGCGGTTGCTGCACCGGCTCACAGAAGCGCACCTTCATCATCGGGCCGAAGGTCGATATGCGTCTCAATTCACAGGACGGAGGCGGTACCTTGGATACTGTGTAGAACATCGCAAGGATCACGGATCTGAGTACCGTAGTACTAGATACGCCGTGTGGAATATGGCTGGCCAGCTAGTCTCATGCCATGTAGTATGCTTGGACGCGTTACCAGCCTGAATGCATTATCGATGATGCTGATTCAGACGCCGTGGATTTAAGGTCTCATCCCAACGGCAGACACAGATACACTGCCGGCTAAGACTCAGCAAGGAGACTCGCCGTTGGAGTCTCAATACTTGCCGTCAGGTATTCAGAGCATGAGGAAGCTCGTAGATTCGACAACCTTGTATCACAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGGGTCCTGAGATGCGGCTTGCTAGCATACATGTGTCTTGCTTCAGGCACCTACGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGCACTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAACGATACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTAATAAAGAGCCTCGGATGGAACTAATTCCTTACTGAGACTTCTGTCAATGCGAGCCGTAGGCGGCATAGACCACGCGCTCTACACCATTGCCGCACGTTGCAACCATTATTCAAGACCTATGTTCGTCCAGCTCGCATGACGCAGATAAGGTGTGCGGTTGCCTCACCGGCTCACACAAGCGCACCTTCATCTATCGAGGCCGAAGGTCGATATGCGGCTGAATTCACAGGACGGAGGGCGGACCATGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTAGTACTAGATACGCCGTGTGGAATATGGCGGCCAGCTAAGTCTCATGCCATCGTTAGTATGCTTGGACGCCGACCAGCCTGATGCATTATCGATATGCTGATTCAGACGCGGTGGATTAAGGCCTCATCCGAACGGAAGACACAGTATACACAGGCCGGCTAAGACTCTGAAAGGAGACTCGCCGTTGAAGTATAATTACTCCGTCAGGTGATGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTGTATCAGAGACTATACTTCAACGGCGAGAGAAGAATGGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACATGTGTCTTGCTTCACGGAACCTGCACGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCAAGATAACTGGAATGAGTACGATACATCCGCCGCTGTAGACTCGCCGAAGTATTCGCCGAATGACCAGCACAACATGGACGCTACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCGAAGCCCACAATGGTGAATAAGAGCCGTCGGATGGAACTCAATTCTTCCTGCGACTTCTGTCAATTCGAGCGCGTAGCCCGGCATACGACCACGCGCTCTATACCACGACCGCCACGTTGCAACACATTATCAAGACCTTGTTTCCGTTCCAGCCTCGCATGACGCCAGATAACGTGGCGGTTCCTCACCGGCTCACAGCAAGCGCACCTTCATCTATCAGGCCAAAGGTCGATATGCGGCTCATTACAGACGGCGCGCGTACCTAGATACTGTGTAGAACATCGCAAGGTCACGGATCTGACGTACCGGTAGTACTAGATACGCCGTCGTGGAATATGGCGGCCAGCTAAGTCCATGCCTGTTAGTATGCTTGGACGCCGTTACCAGCCGATCCATTACTCGATATGCTGATTCAGACGCCGTGGATTAAGGCCTCATCCGAACGGCAGACACAGATACACATGCCGAGCTCAGACTCTGCAAGGGGACTCGCCGATGAAGTCTCAATACTAGCCGTCAGGTGATTGAGAGCATGGGAATGCTAGTGATTCGACACTGTTCAGAGTCCATACTTCAACGGCGAGAGACGAGAGAAGGTTGCGGTCCTGAGATGCGGCTCGCTACCATTACATGTGTCTTGTCTTCAGGCACCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATCATCGCCGCTGAAAGACTCGCCGAAGTATTGCCAGAATGACCAGCATCAACATGGAACGACGGCACCACACGAGAGCCAGATGTTCCTAAGAGTGCCGAGCCACAATGGTGATAAGAGCCGTCGGCATGTAACTCAATTCTTACTGCGACTTACTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGGCTCTACACAATGACCGCACGTTGCAACCATTATTCAACACCTATGTTCCGTCCAGCCTCGCATGACGCCAGATAAGGTGTGCGGTTGCTCACCGGCTCACAGCAAGCACACCTTCATCTATCAGGCCGAAGGTCGATAAGCGGCTCAATTCACAGGACGGAGGCGGTCCCTAGATACTGTGTAGAACACGCAAGGATCACGGATCGGGACGTACCGTTGTACTAGCATACGCCGTCTGGAATATGGCGGCAGCTAAGTATCATGCCATGTTAGTAGCTTGGACGCCGTTACCAGCCTGATGCAATTATCGATATGCTGATTCAGACGCCGAGGCATTAAGGCCTCATCCGAACGGCAGACACAGATACACATGCCGGCTAAGACTCTGCAAGGAGACTCGCCGTTGAAGTCTCAATTACTGCCGTAGGTGATTAGAGCTGAGAAGCTCGTAGATTCGACAACTTGTATCAGAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGCGGTCTGAGATGCGGCTTGCTACGCATTACATGTGTCTTCTTCAGTGCACCTGCGCGGAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGATCGCCGAAGTATTGCCGAATGAGCCAGGCATCAACATGGAACGCTACGCCACCACACGAGAGCCACAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAGCCGTCGGATCGAAACTCAATTCTTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCGTACGACCACGCGCTCTACACCATGACCGCAACGTTGCAACCATTATTCAAGACCATATGTTCCGTCAGCCTCGCATGACGCCAGATAAGTGTGCGGTTGCTCACCGGCTCACAGCAAGCGCACCTTCATCGTATCGAGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGTACCTAGATACTGTGTAGAACATCGCAAGGATCACGAGATCTGACGTACCGTTAAGTACAAGATACGCCGTGCTGGAATATGGCGGCCAGCTAAGTCTGATGCCATGTTAGTATCTTGGACGCCGTTCCAGCCTGATGCATTATCGATATGCTGATTCAGACGCCTTGGATTAAGGCCTCATCCGACGCAGACACAGAGACACATGCCGGCTAAGATCTGCAAGGAGACTCGCCGAGGAAGTCTCAGTTACTGCGTGAGGTGATTGAGAGAATGAGGAAGCTCGTAATTCGACAACTTGTATCAGAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGCGGTCCTGAGATGCGGCTTGCTACATTACATGTGTCTTGCTTCAGGCACCTGCGACGCAATTACAATTCAA"));
    EXPECT_NO_THROW(reads.AddRead("GCGCTAACTGGAATTAGTACGATACATCCGCCGGCTGTAAGACTCGCGAAGTATTGCCGATATGACCAGCATCCACATGGAACGCTACCACAACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCAAATGTGAATAAGAGCCGTCGGATTGGAACTCAATTCTTTCACTGCATCTTCTGTCAATGCGAGCCGTAGGCCGGCATACGACCACGCGCTCTAGCACCTATGACCGCACGTTGCAACCATTATTCAAGCCCTATGTTCCGTCCACCTCGCATCACGCCAGATAAGGTTTGCGGTTGCTCACCGGCTCAGAGCAAGGCACCTTCATCCATCGAGGCCGAAGGTCGATACTGCGGCTCAATTCACAGGACGGGGCGGTACCTAGAATTCTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACTGATAGTACAGATACGCCGTGTGGAATGATGGCGCGCCAGCTAAGTCTCATGCCATGTCAGTATGCTTGGACGCCGTTACCAGCTGATGCATTATGCGCATAATGCTGATTCAGACGCCGTGGATAAGGCCTCATCCGAACGGCAGACCCAGATACACATGCCGGCTAAACTCTGCAAGGAGACTCGCCTTTCAAGTCTGAATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGACACTTGTATCAGAGTCTATTCTTCAACGGCGAGAGACGAGAAGGTTGCGGTCCTGAGATACGGCTTGCTAGCATTACATGTGTCTTGCTTCAGGCTCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACGGAATTAGTAGATATATCCGCGCTGTAAGAGCTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAATGCTACGCCACCACACAGAGAGCCCATAAGTTCCGAGGCAGTGCCGAGCCACACTGGTGAATAAGAGCCGTCGGATGCAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTACACCTTGACCGCACCTTGCAACCATTATATCAAGTCTATGCTCCGTCCAGCCTCGCAGACGCCAGATCAAGGTGTGCGGTTGCTCACCTGCTCACAGCAGCGCACCTTATCTATCGTGGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGTAACTTAGATACTGTGTAGAACATCGCAAGGATCACGGATCGACGTACCGTTAGTACTAGATTACCCCGGTGGAATATGGCGGCCATGCTAAGTCTCAGCATTGTTAGTATGCTCGGACGCCGTTACCAGCCTGATGCATTATCGATATGCTGATTCAGACGCGTGGATTAAGGGCCTCATCCGCAACGGCCAGACACAGATACTCATGACGGCTAAGACTCCAAGGAGCTCGCGTTGAAGTCTCAATTACTGCCGTCAGGGTGAATTGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTGTACAGAGTCTATACTTCAACGGCGCGAGACGAGAAGGGTTGCGGTCCTGAGATGCCGGCTTGCTAGAATCACATGTGTCTTGCTTCATGGCACCTACGGCGACAATTACAATTCAAC"));

    dataset.AddCluster(reads);
    cluster = dataset.GetView(0);

    EXPECT_EQ(cluster.GetReadAt(0), "GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGATCTCGCCGAAGTATTTGCCGAATGACCAGCATCAACATGGGAACGCTACCCCACCACCGAGAGCCAGGAGTTCCTGAGGAGTGCCGAGCCATAATGGTGAATAAGAGCCGTCTGGATAGGAACTCAATTCTTACTGCGCTCCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTACACGATGACCGCACGTTGCAACCATTAAACAGAGACCTAGTTCCGTCCCGCCTCGCATGACGCCAGATATAGGTGTGCGGTTGCTCACCTGGCTCACAGCAAGCGCACCTTCATCGTATCGAGGCCGAAGGTCGATATGGGCTCAATTCACAAGCACGGAGGCGGTACCTAGAACTGTGTAACATCGCAAGATCACGGACTCTGCGTACCGTTAGTACTAGATACGCCGTGTTGAATAGGGCTGCAGCTAAGTCTCATGCCATGTTAGTATGCTGGACGCCGTTACCAGCCTGATGGCATTATCGATATGCGTGGTTCAGACGCCGTGGATTAAGGCCTCATCCGAACGAGCAGACACAAGATACACATGCCGGCTAAGACTCTGCAAGAGCCTCGCCGTTGAAGTCGTAATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGAAACTGTATCAGAGTCTATACTTCAAGCGGCGAAAGACGAAAAGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACATGTGCTTCGCTTCAGGCACCTGCGCGCAATTACAATTCAAC");
    EXPECT_EQ(cluster.GetReadAt(1), "GCGGATAACTGGAATTTCGTACGATACATCGCCGGTGTAAGAACTCTCCGAAGTATTGCCGAATGACCAGCATCAACATGGGAACGCTACGCCACCACACGAGAGCCAGAAGTTGCGTGAGAGTGCCGAGCCACAATGGTAAAAAGAGCCGTCGGACTGGCACTCAATTCTTACTGCGACTTCTGTCAATGCGGCCGTAGGCCGCGTATACGACCACGCGCTCTACAGCCATCCGCAAGTTGCACCATTTTCAAGACCTATGTTCCGTCCAGCCTCGCATGACGCCAGATAAGGTGTGCGTTGCTCACCGGCTCACAGCAAGCGCACCTCATCTTCGAGGCCGAAGGTCGATATGCGGCCAATACAGGACGGAGGCGGTACCTAGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTTAGTACTGAAACGCCGTGTCGAATATGGCGGCCAGCTAAGTCTCGATGCCATGTTCGTATGCTTGGACGCCGTTACCAGCCCTATGCATATCGATATGCTGATATCAGACGCTCGGGATTAAGCCTCATCCGAACGGCAGCCACGGCTACACATGCCGGCAAACTCTGCAAGGCAGACTCGCCGTTGAAGTCTCAATTACTGCCGTCAGGTGATGAGAGCATGAGGAAGCTCGTGGTTCGACACTTGTATCAGAGTCTATACTTCTAACGGTCGAGAGACGAGAGGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACAGTGTGGTCTTGCTTCAGGCAACTGCTGCGCAATACAAATTCCAAC");
    EXPECT_EQ(cluster.GetReadAt(2), "GCGGATAACTGGAATTAGTACTGATACATCCGCCGCTGTAAGACTCGCCGAAAGTATTGCCGAATGACCAGCATCAACTGGAACGCTACCCACACACGAGAGCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAGCCGTCGATGGAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGTCATACGACCACGCGCTCTAGACCATGACCGCACGTGTGCAACCATTATTCAAGACCTGTGTTCGTCCAGCCTCGCATGACGACCAGATAAGGTGTTGCGGTTGCTCACCGGCTCACAGCAAGCGCACCTTCATCTATCAGGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGACCTAGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTAGTACTAGATACGCCGGTGTGGAATATGGCGGCCAGCTAAGTCTCATGCCATGCTAGTATGCTTGGAGCCGTTACCCAGCCTGATGCATTATCGATATCCTGATTCAGACCCGTGGCATTAAGGCCTCATCCGATCGGCAACACAGATACCATGCCGGCTAAGACTCTGCAAGGAGAATCGCCGTTGAAGTCTCTATTCTACCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCAACAACTTGTGTCAGAGTCTATCTTCAACGGCGTGAACGAGAAGGTTGCAGTCCTGAGATGCGGCTTGCTAGCATTACATGTGTCTTGCTTCAGGCACCTGCGCGCAATTACAATTCAAC");
    EXPECT_EQ(cluster.GetReadAt(3), "GCGGATAACGGATTAGTACGATACATCCGCCGCTGTAAGACTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAACGCGTACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGACGCCACATATGGTGAATAAGAGCCGTCGGATGGAATCTCAATTCTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTGCACCATGACCGCACGTTGCAACCATTGTTCAAGACCTATGTTCCGTCCAGCCTCCCATGACGCCAGATAAGGTGTGCGTTGCTCCCGGCTCACAGCAAGCGCACCTTCATCTATCGAGGCCGAAGGTCGATATGCGGCTTAATTCACAGGACGGAGGCGTTACCTAGATACTGTGTAGAACACGCAAGGATCCGGATCTGACGTCCCGTTAGTACTAGGTACGCCGTGTGGAATATGGCGGCCAGCTAAGTCTCTTGGCCATGTTAGTATGCTTGGACGCCGTATACCAGCCTGATGCATTATCGATATGCATGATTCAGACGCCGTGGATTAAGGCCTTATCCGAGACGGCAGACAGAGATACACATGCCGGCTAAGACTCTGGAAGGAGACTCGCCTTGAAGCCTCATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTCTATCAGAGTTATACTTCAACGGGCGAGAGACGAGAAGGTTGGGTACCTGAGATGCGCTTGCTCGCATTACATGTGTCTTGCTTCAGGCACCTGCGCGCAATACAATTCAAC");
    EXPECT_EQ(cluster.GetReadAt(4), "GCGGATATCTGGAATTAGTCCGATACATCCGCCGCTGTATAGACTCGCCGAAGATTCCGAATGACCAGCATCAACATGGAACGCTACGCCACCACAGACGAGAGCCAGAAGTTCCTGAGGAGCGCCGAGCCACAATGCTGAATAAGGCCGTCGGATGGAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCCCGCGCTCTACACCATGATGCACGTATGCAACCATTATTCAAGCCTCTGTTCCGTCCAGCCTCGCATGACGCCAGATAATGTGTGGGTTGCTCACCGGCTCACAGGAAGCGCACCTTGCATCTTCGAGGCCGATAGGATCGATTGCGGCTCAATTCACAGGACGGAGGGGGTACCTAGATACTGTGTAGGAACATCGCAAGGATCACGGATCTGTCGTACCCGTTAGTACTAGATATCCGTGTGGAATATGGTGGCCAGCTAAGTCTCGTGCCAGTTAGTATGCTTGGACGCCGTTACCAGCCTGATGCATTATCGATATGCTGATTCAGACTCCGTGGATTAAGTCCCATCCGAACGGCAGACACAGATAACGTGCCGGCTCAGACTCTGCAAGGAGACTCGCCGTTGAAATCCATTACTGACGTCAGGTTGATAAGACATGAGGAAGCTCGTAGATTCGACAACTTGTATAGAGTCTATACTTCAACGGACGAGAGACGAGAAGGTTGCGGTCCAGACATGCAGCTTGCTAGCATACATGTGTCTTGCTTCAGGCACCTGCCGCAATATACAATTCAAAC");
    EXPECT_EQ(cluster.GetReadAt(5), "GCGGATAACTGGAATTAGACGATACATCCGCCCCTGTAGACTCGCCGAAGTATTGCCGAATGACCGCATCAACATGGAACGCTACGCCACACACGGGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAACCGTCGGGTGGAACTCAATTCTTACTGCGGACTTCTGTCAATGCGAGCCGAGAGTCGGCATACGACCACGCGCTCTACACCATAACCTGCACGTTGCAACCATTATTCAAGCACCTATGTTCCGCCAGCCTCGCTTGACGCCGAATAAGGTGTGCGGTTGCTGCACCGGCTCACAGAAGCGCACCTTCATCATCGGGCCGAAGGTCGATATGCGTCTCAATTCACAGGACGGAGGCGGTACCTTGGATACTGTGTAGAACATCGCAAGGATCACGGATCTGAGTACCGTAGTACTAGATACGCCGTGTGGAATATGGCTGGCCAGCTAGTCTCATGCCATGTAGTATGCTTGGACGCGTTACCAGCCTGAATGCATTATCGATGATGCTGATTCAGACGCCGTGGATTTAAGGTCTCATCCCAACGGCAGACACAGATACACTGCCGGCTAAGACTCAGCAAGGAGACTCGCCGTTGGAGTCTCAATACTTGCCGTCAGGTATTCAGAGCATGAGGAAGCTCGTAGATTCGACAACCTTGTATCACAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGGGTCCTGAGATGCGGCTTGCTAGCATACATGTGTCTTGCTTCAGGCACCTACGCGCAATTACAATTCAAC");
    EXPECT_EQ(cluster.GetReadAt(6), "GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGCACTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAACGATACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTAATAAAGAGCCTCGGATGGAACTAATTCCTTACTGAGACTTCTGTCAATGCGAGCCGTAGGCGGCATAGACCACGCGCTCTACACCATTGCCGCACGTTGCAACCATTATTCAAGACCTATGTTCGTCCAGCTCGCATGACGCAGATAAGGTGTGCGGTTGCCTCACCGGCTCACACAAGCGCACCTTCATCTATCGAGGCCGAAGGTCGATATGCGGCTGAATTCACAGGACGGAGGGCGGACCATGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTAGTACTAGATACGCCGTGTGGAATATGGCGGCCAGCTAAGTCTCATGCCATCGTTAGTATGCTTGGACGCCGACCAGCCTGATGCATTATCGATATGCTGATTCAGACGCGGTGGATTAAGGCCTCATCCGAACGGAAGACACAGTATACACAGGCCGGCTAAGACTCTGAAAGGAGACTCGCCGTTGAAGTATAATTACTCCGTCAGGTGATGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTGTATCAGAGACTATACTTCAACGGCGAGAGAAGAATGGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACATGTGTCTTGCTTCACGGAACCTGCACGCAATTACAATTCAAC");
    EXPECT_EQ(cluster.GetReadAt(7), "GCAAGATAACTGGAATGAGTACGATACATCCGCCGCTGTAGACTCGCCGAAGTATTCGCCGAATGACCAGCACAACATGGACGCTACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCGAAGCCCACAATGGTGAATAAGAGCCGTCGGATGGAACTCAATTCTTCCTGCGACTTCTGTCAATTCGAGCGCGTAGCCCGGCATACGACCACGCGCTCTATACCACGACCGCCACGTTGCAACACATTATCAAGACCTTGTTTCCGTTCCAGCCTCGCATGACGCCAGATAACGTGGCGGTTCCTCACCGGCTCACAGCAAGCGCACCTTCATCTATCAGGCCAAAGGTCGATATGCGGCTCATTACAGACGGCGCGCGTACCTAGATACTGTGTAGAACATCGCAAGGTCACGGATCTGACGTACCGGTAGTACTAGATACGCCGTCGTGGAATATGGCGGCCAGCTAAGTCCATGCCTGTTAGTATGCTTGGACGCCGTTACCAGCCGATCCATTACTCGATATGCTGATTCAGACGCCGTGGATTAAGGCCTCATCCGAACGGCAGACACAGATACACATGCCGAGCTCAGACTCTGCAAGGGGACTCGCCGATGAAGTCTCAATACTAGCCGTCAGGTGATTGAGAGCATGGGAATGCTAGTGATTCGACACTGTTCAGAGTCCATACTTCAACGGCGAGAGACGAGAGAAGGTTGCGGTCCTGAGATGCGGCTCGCTACCATTACATGTGTCTTGTCTTCAGGCACCTGCGCGCAATTACAATTCAAC");
    EXPECT_EQ(cluster.GetReadAt(8), "GCGGATAACTGGAATTAGTACGATCATCGCCGCTGAAAGACTCGCCGAAGTATTGCCAGAATGACCAGCATCAACATGGAACGACGGCACCACACGAGAGCCAGATGTTCCTAAGAGTGCCGAGCCACAATGGTGATAAGAGCCGTCGGCATGTAACTCAATTCTTACTGCGACTTACTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGGCTCTACACAATGACCGCACGTTGCAACCATTATTCAACACCTATGTTCCGTCCAGCCTCGCATGACGCCAGATAAGGTGTGCGGTTGCTCACCGGCTCACAGCAAGCACACCTTCATCTATCAGGCCGAAGGTCGATAAGCGGCTCAATTCACAGGACGGAGGCGGTCCCTAGATACTGTGTAGAACACGCAAGGATCACGGATCGGGACGTACCGTTGTACTAGCATACGCCGTCTGGAATATGGCGGCAGCTAAGTATCATGCCATGTTAGTAGCTTGGACGCCGTTACCAGCCTGATGCAATTATCGATATGCTGATTCAGACGCCGAGGCATTAAGGCCTCATCCGAACGGCAGACACAGATACACATGCCGGCTAAGACTCTGCAAGGAGACTCGCCGTTGAAGTCTCAATTACTGCCGTAGGTGATTAGAGCTGAGAAGCTCGTAGATTCGACAACTTGTATCAGAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGCGGTCTGAGATGCGGCTTGCTACGCATTACATGTGTCTTCTTCAGTGCACCTGCGCGGAATTACAATTCAAC");
    EXPECT_EQ(cluster.GetReadAt(9), "GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGATCGCCGAAGTATTGCCGAATGAGCCAGGCATCAACATGGAACGCTACGCCACCACACGAGAGCCACAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAGCCGTCGGATCGAAACTCAATTCTTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCGTACGACCACGCGCTCTACACCATGACCGCAACGTTGCAACCATTATTCAAGACCATATGTTCCGTCAGCCTCGCATGACGCCAGATAAGTGTGCGGTTGCTCACCGGCTCACAGCAAGCGCACCTTCATCGTATCGAGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGTACCTAGATACTGTGTAGAACATCGCAAGGATCACGAGATCTGACGTACCGTTAAGTACAAGATACGCCGTGCTGGAATATGGCGGCCAGCTAAGTCTGATGCCATGTTAGTATCTTGGACGCCGTTCCAGCCTGATGCATTATCGATATGCTGATTCAGACGCCTTGGATTAAGGCCTCATCCGACGCAGACACAGAGACACATGCCGGCTAAGATCTGCAAGGAGACTCGCCGAGGAAGTCTCAGTTACTGCGTGAGGTGATTGAGAGAATGAGGAAGCTCGTAATTCGACAACTTGTATCAGAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGCGGTCCTGAGATGCGGCTTGCTACATTACATGTGTCTTGCTTCAGGCACCTGCGACGCAATTACAATTCAA");
    EXPECT_EQ(cluster.GetReadAt(10), "GCGCTAACTGGAATTAGTACGATACATCCGCCGGCTGTAAGACTCGCGAAGTATTGCCGATATGACCAGCATCCACATGGAACGCTACCACAACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCAAATGTGAATAAGAGCCGTCGGATTGGAACTCAATTCTTTCACTGCATCTTCTGTCAATGCGAGCCGTAGGCCGGCATACGACCACGCGCTCTAGCACCTATGACCGCACGTTGCAACCATTATTCAAGCCCTATGTTCCGTCCACCTCGCATCACGCCAGATAAGGTTTGCGGTTGCTCACCGGCTCAGAGCAAGGCACCTTCATCCATCGAGGCCGAAGGTCGATACTGCGGCTCAATTCACAGGACGGGGCGGTACCTAGAATTCTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACTGATAGTACAGATACGCCGTGTGGAATGATGGCGCGCCAGCTAAGTCTCATGCCATGTCAGTATGCTTGGACGCCGTTACCAGCTGATGCATTATGCGCATAATGCTGATTCAGACGCCGTGGATAAGGCCTCATCCGAACGGCAGACCCAGATACACATGCCGGCTAAACTCTGCAAGGAGACTCGCCTTTCAAGTCTGAATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGACACTTGTATCAGAGTCTATTCTTCAACGGCGAGAGACGAGAAGGTTGCGGTCCTGAGATACGGCTTGCTAGCATTACATGTGTCTTGCTTCAGGCTCTGCGCGCAATTACAATTCAAC");
    EXPECT_EQ(cluster.GetReadAt(11), "GCGGATAACGGAATTAGTAGATATATCCGCGCTGTAAGAGCTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAATGCTACGCCACCACACAGAGAGCCCATAAGTTCCGAGGCAGTGCCGAGCCACACTGGTGAATAAGAGCCGTCGGATGCAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTACACCTTGACCGCACCTTGCAACCATTATATCAAGTCTATGCTCCGTCCAGCCTCGCAGACGCCAGATCAAGGTGTGCGGTTGCTCACCTGCTCACAGCAGCGCACCTTATCTATCGTGGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGTAACTTAGATACTGTGTAGAACATCGCAAGGATCACGGATCGACGTACCGTTAGTACTAGATTACCCCGGTGGAATATGGCGGCCATGCTAAGTCTCAGCATTGTTAGTATGCTCGGACGCCGTTACCAGCCTGATGCATTATCGATATGCTGATTCAGACGCGTGGATTAAGGGCCTCATCCGCAACGGCCAGACACAGATACTCATGACGGCTAAGACTCCAAGGAGCTCGCGTTGAAGTCTCAATTACTGCCGTCAGGGTGAATTGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTGTACAGAGTCTATACTTCAACGGCGCGAGACGAGAAGGGTTGCGGTCCTGAGATGCCGGCTTGCTAGAATCACATGTGTCTTGCTTCATGGCACCTACGGCGACAATTACAATTCAAC");

    EXPECT_EQ(cluster.Size(), 12);
    cluster.Clear();
    EXPECT_EQ(cluster.Size(), 0);
}



TEST(ClusterView, AddReadTwo) {

    ClustersDataset dataset;
    Cluster reads;
    ClusterView cluster;

    EXPECT_NO_THROW(reads.AddRead("AGTACGATACATCCGC"));
    EXPECT_NO_THROW(reads.AddRead("TCGTACGATACATCGCCGG"));
    EXPECT_NO_THROW(reads.AddRead("AGTACTGATACATCCGCCG"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATACATCCGC"));
    EXPECT_NO_THROW(reads.AddRead("AGTCCGATACATCCGC"));

    dataset.AddCluster(reads);

    cluster = dataset.GetView(0);

    EXPECT_EQ(cluster.GetReadAt(0), "AGTACGATACATCCGC");
    EXPECT_EQ(cluster.GetReadAt(1), "TCGTACGATACATCGCCGG");
    EXPECT_EQ(cluster.GetReadAt(2), "AGTACTGATACATCCGCCG");
    EXPECT_EQ(cluster.GetReadAt(3), "AGTACGATACATCCGC");
    EXPECT_EQ(cluster.GetReadAt(4), "AGTCCGATACATCCGC");


    EXPECT_EQ(cluster.Size(), 5);
    cluster.Clear();
    EXPECT_EQ(cluster.Size(), 0);
}


TEST(ClusterView, ConsensusTwoMotifs) {
    std::string reference = "GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGACTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAACGCTACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAGCCGTCGGATGGAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTACACCATGACCGCACGTTGCAACCATTATTCAAGACCTATGTTCCGTCCAGCCTCGCATGACGCCAGATAAGGTGTGCGGTTGCTCACCGGCTCACAGCAAGCGCACCTTCATCTATCGAGGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGTACCTAGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTAGTACTAGATACGCCGTGTGGAATATGGCGGCCAGCTAAGTCTCATGCCATGTTAGTATGCTTGGACGCCGTTACCAGCCTGATGCATTATCGATATGCTGATTCAGACGCCGTGGATTAAGGCCTCATCCGAACGGCAGACACAGATACACATGCCGGCTAAGACTCTGCAAGGAGACTCGCCGTTGAAGTCTCAATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTGTATCAGAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACATGTGTCTTGCTTCAGGCACCTGCGCGCAATTACAATTCAAC";

    ClustersDataset dataset;
    Cluster reads;
    ClusterView cluster;

    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGATCTCGCCGAAGTATTTGCCGAATGACCAGCATCAACATGGGAACGCTACCCCACCACCGAGAGCCAGGAGTTCCTGAGGAGTGCCGAGCCATAATGGTGAATAAGAGCCGTCTGGATAGGAACTCAATTCTTACTGCGCTCCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTACACGATGACCGCACGTTGCAACCATTAAACAGAGACCTAGTTCCGTCCCGCCTCGCATGACGCCAGATATAGGTGTGCGGTTGCTCACCTGGCTCACAGCAAGCGCACCTTCATCGTATCGAGGCCGAAGGTCGATATGGGCTCAATTCACAAGCACGGAGGCGGTACCTAGAACTGTGTAACATCGCAAGATCACGGACTCTGCGTACCGTTAGTACTAGATACGCCGTGTTGAATAGGGCTGCAGCTAAGTCTCATGCCATGTTAGTATGCTGGACGCCGTTACCAGCCTGATGGCATTATCGATATGCGTGGTTCAGACGCCGTGGATTAAGGCCTCATCCGAACGAGCAGACACAAGATACACATGCCGGCTAAGACTCTGCAAGAGCCTCGCCGTTGAAGTCGTAATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGAAACTGTATCAGAGTCTATACTTCAAGCGGCGAAAGACGAAAAGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACATGTGCTTCGCTTCAGGCACCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTTCGTACGATACATCGCCGGTGTAAGAACTCTCCGAAGTATTGCCGAATGACCAGCATCAACATGGGAACGCTACGCCACCACACGAGAGCCAGAAGTTGCGTGAGAGTGCCGAGCCACAATGGTAAAAAGAGCCGTCGGACTGGCACTCAATTCTTACTGCGACTTCTGTCAATGCGGCCGTAGGCCGCGTATACGACCACGCGCTCTACAGCCATCCGCAAGTTGCACCATTTTCAAGACCTATGTTCCGTCCAGCCTCGCATGACGCCAGATAAGGTGTGCGTTGCTCACCGGCTCACAGCAAGCGCACCTCATCTTCGAGGCCGAAGGTCGATATGCGGCCAATACAGGACGGAGGCGGTACCTAGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTTAGTACTGAAACGCCGTGTCGAATATGGCGGCCAGCTAAGTCTCGATGCCATGTTCGTATGCTTGGACGCCGTTACCAGCCCTATGCATATCGATATGCTGATATCAGACGCTCGGGATTAAGCCTCATCCGAACGGCAGCCACGGCTACACATGCCGGCAAACTCTGCAAGGCAGACTCGCCGTTGAAGTCTCAATTACTGCCGTCAGGTGATGAGAGCATGAGGAAGCTCGTGGTTCGACACTTGTATCAGAGTCTATACTTCTAACGGTCGAGAGACGAGAGGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACAGTGTGGTCTTGCTTCAGGCAACTGCTGCGCAATACAAATTCCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACTGATACATCCGCCGCTGTAAGACTCGCCGAAAGTATTGCCGAATGACCAGCATCAACTGGAACGCTACCCACACACGAGAGCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAGCCGTCGATGGAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGTCATACGACCACGCGCTCTAGACCATGACCGCACGTGTGCAACCATTATTCAAGACCTGTGTTCGTCCAGCCTCGCATGACGACCAGATAAGGTGTTGCGGTTGCTCACCGGCTCACAGCAAGCGCACCTTCATCTATCAGGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGACCTAGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTAGTACTAGATACGCCGGTGTGGAATATGGCGGCCAGCTAAGTCTCATGCCATGCTAGTATGCTTGGAGCCGTTACCCAGCCTGATGCATTATCGATATCCTGATTCAGACCCGTGGCATTAAGGCCTCATCCGATCGGCAACACAGATACCATGCCGGCTAAGACTCTGCAAGGAGAATCGCCGTTGAAGTCTCTATTCTACCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCAACAACTTGTGTCAGAGTCTATCTTCAACGGCGTGAACGAGAAGGTTGCAGTCCTGAGATGCGGCTTGCTAGCATTACATGTGTCTTGCTTCAGGCACCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACGGATTAGTACGATACATCCGCCGCTGTAAGACTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAACGCGTACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGACGCCACATATGGTGAATAAGAGCCGTCGGATGGAATCTCAATTCTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTGCACCATGACCGCACGTTGCAACCATTGTTCAAGACCTATGTTCCGTCCAGCCTCCCATGACGCCAGATAAGGTGTGCGTTGCTCCCGGCTCACAGCAAGCGCACCTTCATCTATCGAGGCCGAAGGTCGATATGCGGCTTAATTCACAGGACGGAGGCGTTACCTAGATACTGTGTAGAACACGCAAGGATCCGGATCTGACGTCCCGTTAGTACTAGGTACGCCGTGTGGAATATGGCGGCCAGCTAAGTCTCTTGGCCATGTTAGTATGCTTGGACGCCGTATACCAGCCTGATGCATTATCGATATGCATGATTCAGACGCCGTGGATTAAGGCCTTATCCGAGACGGCAGACAGAGATACACATGCCGGCTAAGACTCTGGAAGGAGACTCGCCTTGAAGCCTCATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTCTATCAGAGTTATACTTCAACGGGCGAGAGACGAGAAGGTTGGGTACCTGAGATGCGCTTGCTCGCATTACATGTGTCTTGCTTCAGGCACCTGCGCGCAATACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATATCTGGAATTAGTCCGATACATCCGCCGCTGTATAGACTCGCCGAAGATTCCGAATGACCAGCATCAACATGGAACGCTACGCCACCACAGACGAGAGCCAGAAGTTCCTGAGGAGCGCCGAGCCACAATGCTGAATAAGGCCGTCGGATGGAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCCCGCGCTCTACACCATGATGCACGTATGCAACCATTATTCAAGCCTCTGTTCCGTCCAGCCTCGCATGACGCCAGATAATGTGTGGGTTGCTCACCGGCTCACAGGAAGCGCACCTTGCATCTTCGAGGCCGATAGGATCGATTGCGGCTCAATTCACAGGACGGAGGGGGTACCTAGATACTGTGTAGGAACATCGCAAGGATCACGGATCTGTCGTACCCGTTAGTACTAGATATCCGTGTGGAATATGGTGGCCAGCTAAGTCTCGTGCCAGTTAGTATGCTTGGACGCCGTTACCAGCCTGATGCATTATCGATATGCTGATTCAGACTCCGTGGATTAAGTCCCATCCGAACGGCAGACACAGATAACGTGCCGGCTCAGACTCTGCAAGGAGACTCGCCGTTGAAATCCATTACTGACGTCAGGTTGATAAGACATGAGGAAGCTCGTAGATTCGACAACTTGTATAGAGTCTATACTTCAACGGACGAGAGACGAGAAGGTTGCGGTCCAGACATGCAGCTTGCTAGCATACATGTGTCTTGCTTCAGGCACCTGCCGCAATATACAATTCAAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGACGATACATCCGCCCCTGTAGACTCGCCGAAGTATTGCCGAATGACCGCATCAACATGGAACGCTACGCCACACACGGGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAACCGTCGGGTGGAACTCAATTCTTACTGCGGACTTCTGTCAATGCGAGCCGAGAGTCGGCATACGACCACGCGCTCTACACCATAACCTGCACGTTGCAACCATTATTCAAGCACCTATGTTCCGCCAGCCTCGCTTGACGCCGAATAAGGTGTGCGGTTGCTGCACCGGCTCACAGAAGCGCACCTTCATCATCGGGCCGAAGGTCGATATGCGTCTCAATTCACAGGACGGAGGCGGTACCTTGGATACTGTGTAGAACATCGCAAGGATCACGGATCTGAGTACCGTAGTACTAGATACGCCGTGTGGAATATGGCTGGCCAGCTAGTCTCATGCCATGTAGTATGCTTGGACGCGTTACCAGCCTGAATGCATTATCGATGATGCTGATTCAGACGCCGTGGATTTAAGGTCTCATCCCAACGGCAGACACAGATACACTGCCGGCTAAGACTCAGCAAGGAGACTCGCCGTTGGAGTCTCAATACTTGCCGTCAGGTATTCAGAGCATGAGGAAGCTCGTAGATTCGACAACCTTGTATCACAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGGGTCCTGAGATGCGGCTTGCTAGCATACATGTGTCTTGCTTCAGGCACCTACGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGCACTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAACGATACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTAATAAAGAGCCTCGGATGGAACTAATTCCTTACTGAGACTTCTGTCAATGCGAGCCGTAGGCGGCATAGACCACGCGCTCTACACCATTGCCGCACGTTGCAACCATTATTCAAGACCTATGTTCGTCCAGCTCGCATGACGCAGATAAGGTGTGCGGTTGCCTCACCGGCTCACACAAGCGCACCTTCATCTATCGAGGCCGAAGGTCGATATGCGGCTGAATTCACAGGACGGAGGGCGGACCATGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTAGTACTAGATACGCCGTGTGGAATATGGCGGCCAGCTAAGTCTCATGCCATCGTTAGTATGCTTGGACGCCGACCAGCCTGATGCATTATCGATATGCTGATTCAGACGCGGTGGATTAAGGCCTCATCCGAACGGAAGACACAGTATACACAGGCCGGCTAAGACTCTGAAAGGAGACTCGCCGTTGAAGTATAATTACTCCGTCAGGTGATGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTGTATCAGAGACTATACTTCAACGGCGAGAGAAGAATGGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACATGTGTCTTGCTTCACGGAACCTGCACGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCAAGATAACTGGAATGAGTACGATACATCCGCCGCTGTAGACTCGCCGAAGTATTCGCCGAATGACCAGCACAACATGGACGCTACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCGAAGCCCACAATGGTGAATAAGAGCCGTCGGATGGAACTCAATTCTTCCTGCGACTTCTGTCAATTCGAGCGCGTAGCCCGGCATACGACCACGCGCTCTATACCACGACCGCCACGTTGCAACACATTATCAAGACCTTGTTTCCGTTCCAGCCTCGCATGACGCCAGATAACGTGGCGGTTCCTCACCGGCTCACAGCAAGCGCACCTTCATCTATCAGGCCAAAGGTCGATATGCGGCTCATTACAGACGGCGCGCGTACCTAGATACTGTGTAGAACATCGCAAGGTCACGGATCTGACGTACCGGTAGTACTAGATACGCCGTCGTGGAATATGGCGGCCAGCTAAGTCCATGCCTGTTAGTATGCTTGGACGCCGTTACCAGCCGATCCATTACTCGATATGCTGATTCAGACGCCGTGGATTAAGGCCTCATCCGAACGGCAGACACAGATACACATGCCGAGCTCAGACTCTGCAAGGGGACTCGCCGATGAAGTCTCAATACTAGCCGTCAGGTGATTGAGAGCATGGGAATGCTAGTGATTCGACACTGTTCAGAGTCCATACTTCAACGGCGAGAGACGAGAGAAGGTTGCGGTCCTGAGATGCGGCTCGCTACCATTACATGTGTCTTGTCTTCAGGCACCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATCATCGCCGCTGAAAGACTCGCCGAAGTATTGCCAGAATGACCAGCATCAACATGGAACGACGGCACCACACGAGAGCCAGATGTTCCTAAGAGTGCCGAGCCACAATGGTGATAAGAGCCGTCGGCATGTAACTCAATTCTTACTGCGACTTACTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGGCTCTACACAATGACCGCACGTTGCAACCATTATTCAACACCTATGTTCCGTCCAGCCTCGCATGACGCCAGATAAGGTGTGCGGTTGCTCACCGGCTCACAGCAAGCACACCTTCATCTATCAGGCCGAAGGTCGATAAGCGGCTCAATTCACAGGACGGAGGCGGTCCCTAGATACTGTGTAGAACACGCAAGGATCACGGATCGGGACGTACCGTTGTACTAGCATACGCCGTCTGGAATATGGCGGCAGCTAAGTATCATGCCATGTTAGTAGCTTGGACGCCGTTACCAGCCTGATGCAATTATCGATATGCTGATTCAGACGCCGAGGCATTAAGGCCTCATCCGAACGGCAGACACAGATACACATGCCGGCTAAGACTCTGCAAGGAGACTCGCCGTTGAAGTCTCAATTACTGCCGTAGGTGATTAGAGCTGAGAAGCTCGTAGATTCGACAACTTGTATCAGAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGCGGTCTGAGATGCGGCTTGCTACGCATTACATGTGTCTTCTTCAGTGCACCTGCGCGGAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGATCGCCGAAGTATTGCCGAATGAGCCAGGCATCAACATGGAACGCTACGCCACCACACGAGAGCCACAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAGCCGTCGGATCGAAACTCAATTCTTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCGTACGACCACGCGCTCTACACCATGACCGCAACGTTGCAACCATTATTCAAGACCATATGTTCCGTCAGCCTCGCATGACGCCAGATAAGTGTGCGGTTGCTCACCGGCTCACAGCAAGCGCACCTTCATCGTATCGAGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGTACCTAGATACTGTGTAGAACATCGCAAGGATCACGAGATCTGACGTACCGTTAAGTACAAGATACGCCGTGCTGGAATATGGCGGCCAGCTAAGTCTGATGCCATGTTAGTATCTTGGACGCCGTTCCAGCCTGATGCATTATCGATATGCTGATTCAGACGCCTTGGATTAAGGCCTCATCCGACGCAGACACAGAGACACATGCCGGCTAAGATCTGCAAGGAGACTCGCCGAGGAAGTCTCAGTTACTGCGTGAGGTGATTGAGAGAATGAGGAAGCTCGTAATTCGACAACTTGTATCAGAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGCGGTCCTGAGATGCGGCTTGCTACATTACATGTGTCTTGCTTCAGGCACCTGCGACGCAATTACAATTCAA"));
    EXPECT_NO_THROW(reads.AddRead("GCGCTAACTGGAATTAGTACGATACATCCGCCGGCTGTAAGACTCGCGAAGTATTGCCGATATGACCAGCATCCACATGGAACGCTACCACAACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCAAATGTGAATAAGAGCCGTCGGATTGGAACTCAATTCTTTCACTGCATCTTCTGTCAATGCGAGCCGTAGGCCGGCATACGACCACGCGCTCTAGCACCTATGACCGCACGTTGCAACCATTATTCAAGCCCTATGTTCCGTCCACCTCGCATCACGCCAGATAAGGTTTGCGGTTGCTCACCGGCTCAGAGCAAGGCACCTTCATCCATCGAGGCCGAAGGTCGATACTGCGGCTCAATTCACAGGACGGGGCGGTACCTAGAATTCTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACTGATAGTACAGATACGCCGTGTGGAATGATGGCGCGCCAGCTAAGTCTCATGCCATGTCAGTATGCTTGGACGCCGTTACCAGCTGATGCATTATGCGCATAATGCTGATTCAGACGCCGTGGATAAGGCCTCATCCGAACGGCAGACCCAGATACACATGCCGGCTAAACTCTGCAAGGAGACTCGCCTTTCAAGTCTGAATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGACACTTGTATCAGAGTCTATTCTTCAACGGCGAGAGACGAGAAGGTTGCGGTCCTGAGATACGGCTTGCTAGCATTACATGTGTCTTGCTTCAGGCTCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACGGAATTAGTAGATATATCCGCGCTGTAAGAGCTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAATGCTACGCCACCACACAGAGAGCCCATAAGTTCCGAGGCAGTGCCGAGCCACACTGGTGAATAAGAGCCGTCGGATGCAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTACACCTTGACCGCACCTTGCAACCATTATATCAAGTCTATGCTCCGTCCAGCCTCGCAGACGCCAGATCAAGGTGTGCGGTTGCTCACCTGCTCACAGCAGCGCACCTTATCTATCGTGGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGTAACTTAGATACTGTGTAGAACATCGCAAGGATCACGGATCGACGTACCGTTAGTACTAGATTACCCCGGTGGAATATGGCGGCCATGCTAAGTCTCAGCATTGTTAGTATGCTCGGACGCCGTTACCAGCCTGATGCATTATCGATATGCTGATTCAGACGCGTGGATTAAGGGCCTCATCCGCAACGGCCAGACACAGATACTCATGACGGCTAAGACTCCAAGGAGCTCGCGTTGAAGTCTCAATTACTGCCGTCAGGGTGAATTGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTGTACAGAGTCTATACTTCAACGGCGCGAGACGAGAAGGGTTGCGGTCCTGAGATGCCGGCTTGCTAGAATCACATGTGTCTTGCTTCATGGCACCTACGGCGACAATTACAATTCAAC"));

    dataset.AddCluster(reads);
    cluster = dataset.GetView(0);

    EXPECT_EQ(cluster.Size(), 12);

    auto consensus = cluster.GetConsensus(16, 4);
    EXPECT_EQ(consensus.GetMotif(), "GCGGATAACTGGAATT");

    // What if motif is not multiple of 16?

    cluster.AdjustReads(consensus.GetMotif(), 4);
    consensus = cluster.GetConsensus(16, 4);
    EXPECT_EQ(consensus.GetMotif(), "AGTACGATACATCCGC");
}

TEST(ClusterView, ConsensusFullReads) {
    std::vector<std::string> reference = {"GCGGATAACTGGAATT",
                                          "AGTACGATACATCCGC",
                                          "CGCTGTAAGACTCGCC",
                                          "GAAGTATTGCCGAATG",
                                          "ACCAGCATCAACATGG",
                                          "AACGCTACGCCACCAC",
                                          "ACGAGAGCCAGAAGTT",
                                          "CCTGAGGAGTGCCGAG",
                                          "CCACAATGGTGAATAA",
                                          "GAGCCGTCGGATGGAA",
                                          "CTCAATTCTTACTGCG",
                                          "ACTTCTGTCAATGCGA",
                                          "GCCGTAGGCGGCATAC",
                                          "GACCACGCGCTCTACA",
                                          "CCATGACCGCACGTTG",
                                          "CAACCATTATTCAAGA",
                                          "CCTATGTTCCGTCCAG",
                                          "CCTCGCATGACGCCAG",
                                          "ATAAGGTGTGCGGTTG",
                                          "CTCACCGGCTCACAGC",
                                          "AAGCGCACCTTCATCT",
                                          "ATCGAGGCCGAAGGTC",
                                          "GATATGCGGCTCAATT",
                                          "CACAGGACGGAGGCGG",
                                          "TACCTAGATACTGTGT",
                                          "AGAACATCGCAAGGAT",
                                          "CACGGATCTGACGTAC",
                                          "CGTTAGTACTAGATAC",
                                          "GCCGTGTGGAATATGG",
                                          "CGGCCAGCTAAGTCTC",
                                          "ATGCCATGTTAGTATG",
                                          "CTTGGACGCCGTTACC",
                                          "AGCCTGATGCATTATC",
                                          "GATATGCTGATTCAGA",
                                          "CGCCGTGGATTAAGGC",
                                          "CTCATCCGAACGGCAG",
                                          "ACACAGATACACATGC",
                                          "CGGCTAAGACTCTGCA",
                                          "AGGAGACTCGCCGTTG",
                                          "AAGTCTCAATTACTGC",
                                          "CGTCAGGTGATTGAGA",
                                          "GCATGAGGAAGCTCGT",
                                          "AGATTCGACAACTTGT",
                                          "ATCAGAGTCTATACTT",
                                          "CAACGGCGAGAGACGA",
                                          "GAAGGTTGCGGTCCTG",
                                          "AGATGCGGCTTGCTAG",
                                          "CATTACATGTGTCTTG",
                                          "CTTCAGGCACCTGCGC",
                                          "GCAATTACAATTCAAC"};

    ClustersDataset dataset;
    Cluster reads;
    ClusterView cluster;

    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGATCTCGCCGAAGTATTTGCCGAATGACCAGCATCAACATGGGAACGCTACCCCACCACCGAGAGCCAGGAGTTCCTGAGGAGTGCCGAGCCATAATGGTGAATAAGAGCCGTCTGGATAGGAACTCAATTCTTACTGCGCTCCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTACACGATGACCGCACGTTGCAACCATTAAACAGAGACCTAGTTCCGTCCCGCCTCGCATGACGCCAGATATAGGTGTGCGGTTGCTCACCTGGCTCACAGCAAGCGCACCTTCATCGTATCGAGGCCGAAGGTCGATATGGGCTCAATTCACAAGCACGGAGGCGGTACCTAGAACTGTGTAACATCGCAAGATCACGGACTCTGCGTACCGTTAGTACTAGATACGCCGTGTTGAATAGGGCTGCAGCTAAGTCTCATGCCATGTTAGTATGCTGGACGCCGTTACCAGCCTGATGGCATTATCGATATGCGTGGTTCAGACGCCGTGGATTAAGGCCTCATCCGAACGAGCAGACACAAGATACACATGCCGGCTAAGACTCTGCAAGAGCCTCGCCGTTGAAGTCGTAATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGAAACTGTATCAGAGTCTATACTTCAAGCGGCGAAAGACGAAAAGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACATGTGCTTCGCTTCAGGCACCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTTCGTACGATACATCGCCGGTGTAAGAACTCTCCGAAGTATTGCCGAATGACCAGCATCAACATGGGAACGCTACGCCACCACACGAGAGCCAGAAGTTGCGTGAGAGTGCCGAGCCACAATGGTAAAAAGAGCCGTCGGACTGGCACTCAATTCTTACTGCGACTTCTGTCAATGCGGCCGTAGGCCGCGTATACGACCACGCGCTCTACAGCCATCCGCAAGTTGCACCATTTTCAAGACCTATGTTCCGTCCAGCCTCGCATGACGCCAGATAAGGTGTGCGTTGCTCACCGGCTCACAGCAAGCGCACCTCATCTTCGAGGCCGAAGGTCGATATGCGGCCAATACAGGACGGAGGCGGTACCTAGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTTAGTACTGAAACGCCGTGTCGAATATGGCGGCCAGCTAAGTCTCGATGCCATGTTCGTATGCTTGGACGCCGTTACCAGCCCTATGCATATCGATATGCTGATATCAGACGCTCGGGATTAAGCCTCATCCGAACGGCAGCCACGGCTACACATGCCGGCAAACTCTGCAAGGCAGACTCGCCGTTGAAGTCTCAATTACTGCCGTCAGGTGATGAGAGCATGAGGAAGCTCGTGGTTCGACACTTGTATCAGAGTCTATACTTCTAACGGTCGAGAGACGAGAGGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACAGTGTGGTCTTGCTTCAGGCAACTGCTGCGCAATACAAATTCCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACTGATACATCCGCCGCTGTAAGACTCGCCGAAAGTATTGCCGAATGACCAGCATCAACTGGAACGCTACCCACACACGAGAGCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAGCCGTCGATGGAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGTCATACGACCACGCGCTCTAGACCATGACCGCACGTGTGCAACCATTATTCAAGACCTGTGTTCGTCCAGCCTCGCATGACGACCAGATAAGGTGTTGCGGTTGCTCACCGGCTCACAGCAAGCGCACCTTCATCTATCAGGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGACCTAGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTAGTACTAGATACGCCGGTGTGGAATATGGCGGCCAGCTAAGTCTCATGCCATGCTAGTATGCTTGGAGCCGTTACCCAGCCTGATGCATTATCGATATCCTGATTCAGACCCGTGGCATTAAGGCCTCATCCGATCGGCAACACAGATACCATGCCGGCTAAGACTCTGCAAGGAGAATCGCCGTTGAAGTCTCTATTCTACCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCAACAACTTGTGTCAGAGTCTATCTTCAACGGCGTGAACGAGAAGGTTGCAGTCCTGAGATGCGGCTTGCTAGCATTACATGTGTCTTGCTTCAGGCACCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACGGATTAGTACGATACATCCGCCGCTGTAAGACTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAACGCGTACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGACGCCACATATGGTGAATAAGAGCCGTCGGATGGAATCTCAATTCTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTGCACCATGACCGCACGTTGCAACCATTGTTCAAGACCTATGTTCCGTCCAGCCTCCCATGACGCCAGATAAGGTGTGCGTTGCTCCCGGCTCACAGCAAGCGCACCTTCATCTATCGAGGCCGAAGGTCGATATGCGGCTTAATTCACAGGACGGAGGCGTTACCTAGATACTGTGTAGAACACGCAAGGATCCGGATCTGACGTCCCGTTAGTACTAGGTACGCCGTGTGGAATATGGCGGCCAGCTAAGTCTCTTGGCCATGTTAGTATGCTTGGACGCCGTATACCAGCCTGATGCATTATCGATATGCATGATTCAGACGCCGTGGATTAAGGCCTTATCCGAGACGGCAGACAGAGATACACATGCCGGCTAAGACTCTGGAAGGAGACTCGCCTTGAAGCCTCATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTCTATCAGAGTTATACTTCAACGGGCGAGAGACGAGAAGGTTGGGTACCTGAGATGCGCTTGCTCGCATTACATGTGTCTTGCTTCAGGCACCTGCGCGCAATACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATATCTGGAATTAGTCCGATACATCCGCCGCTGTATAGACTCGCCGAAGATTCCGAATGACCAGCATCAACATGGAACGCTACGCCACCACAGACGAGAGCCAGAAGTTCCTGAGGAGCGCCGAGCCACAATGCTGAATAAGGCCGTCGGATGGAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCCCGCGCTCTACACCATGATGCACGTATGCAACCATTATTCAAGCCTCTGTTCCGTCCAGCCTCGCATGACGCCAGATAATGTGTGGGTTGCTCACCGGCTCACAGGAAGCGCACCTTGCATCTTCGAGGCCGATAGGATCGATTGCGGCTCAATTCACAGGACGGAGGGGGTACCTAGATACTGTGTAGGAACATCGCAAGGATCACGGATCTGTCGTACCCGTTAGTACTAGATATCCGTGTGGAATATGGTGGCCAGCTAAGTCTCGTGCCAGTTAGTATGCTTGGACGCCGTTACCAGCCTGATGCATTATCGATATGCTGATTCAGACTCCGTGGATTAAGTCCCATCCGAACGGCAGACACAGATAACGTGCCGGCTCAGACTCTGCAAGGAGACTCGCCGTTGAAATCCATTACTGACGTCAGGTTGATAAGACATGAGGAAGCTCGTAGATTCGACAACTTGTATAGAGTCTATACTTCAACGGACGAGAGACGAGAAGGTTGCGGTCCAGACATGCAGCTTGCTAGCATACATGTGTCTTGCTTCAGGCACCTGCCGCAATATACAATTCAAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGACGATACATCCGCCCCTGTAGACTCGCCGAAGTATTGCCGAATGACCGCATCAACATGGAACGCTACGCCACACACGGGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAACCGTCGGGTGGAACTCAATTCTTACTGCGGACTTCTGTCAATGCGAGCCGAGAGTCGGCATACGACCACGCGCTCTACACCATAACCTGCACGTTGCAACCATTATTCAAGCACCTATGTTCCGCCAGCCTCGCTTGACGCCGAATAAGGTGTGCGGTTGCTGCACCGGCTCACAGAAGCGCACCTTCATCATCGGGCCGAAGGTCGATATGCGTCTCAATTCACAGGACGGAGGCGGTACCTTGGATACTGTGTAGAACATCGCAAGGATCACGGATCTGAGTACCGTAGTACTAGATACGCCGTGTGGAATATGGCTGGCCAGCTAGTCTCATGCCATGTAGTATGCTTGGACGCGTTACCAGCCTGAATGCATTATCGATGATGCTGATTCAGACGCCGTGGATTTAAGGTCTCATCCCAACGGCAGACACAGATACACTGCCGGCTAAGACTCAGCAAGGAGACTCGCCGTTGGAGTCTCAATACTTGCCGTCAGGTATTCAGAGCATGAGGAAGCTCGTAGATTCGACAACCTTGTATCACAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGGGTCCTGAGATGCGGCTTGCTAGCATACATGTGTCTTGCTTCAGGCACCTACGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGCACTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAACGATACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCACAATGGTAATAAAGAGCCTCGGATGGAACTAATTCCTTACTGAGACTTCTGTCAATGCGAGCCGTAGGCGGCATAGACCACGCGCTCTACACCATTGCCGCACGTTGCAACCATTATTCAAGACCTATGTTCGTCCAGCTCGCATGACGCAGATAAGGTGTGCGGTTGCCTCACCGGCTCACACAAGCGCACCTTCATCTATCGAGGCCGAAGGTCGATATGCGGCTGAATTCACAGGACGGAGGGCGGACCATGATACTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACCGTTAGTACTAGATACGCCGTGTGGAATATGGCGGCCAGCTAAGTCTCATGCCATCGTTAGTATGCTTGGACGCCGACCAGCCTGATGCATTATCGATATGCTGATTCAGACGCGGTGGATTAAGGCCTCATCCGAACGGAAGACACAGTATACACAGGCCGGCTAAGACTCTGAAAGGAGACTCGCCGTTGAAGTATAATTACTCCGTCAGGTGATGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTGTATCAGAGACTATACTTCAACGGCGAGAGAAGAATGGGTTGCGGTCCTGAGATGCGGCTTGCTAGCATTACATGTGTCTTGCTTCACGGAACCTGCACGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCAAGATAACTGGAATGAGTACGATACATCCGCCGCTGTAGACTCGCCGAAGTATTCGCCGAATGACCAGCACAACATGGACGCTACGCCACCACACGAGAGCCAGAAGTTCCTGAGGAGTGCGAAGCCCACAATGGTGAATAAGAGCCGTCGGATGGAACTCAATTCTTCCTGCGACTTCTGTCAATTCGAGCGCGTAGCCCGGCATACGACCACGCGCTCTATACCACGACCGCCACGTTGCAACACATTATCAAGACCTTGTTTCCGTTCCAGCCTCGCATGACGCCAGATAACGTGGCGGTTCCTCACCGGCTCACAGCAAGCGCACCTTCATCTATCAGGCCAAAGGTCGATATGCGGCTCATTACAGACGGCGCGCGTACCTAGATACTGTGTAGAACATCGCAAGGTCACGGATCTGACGTACCGGTAGTACTAGATACGCCGTCGTGGAATATGGCGGCCAGCTAAGTCCATGCCTGTTAGTATGCTTGGACGCCGTTACCAGCCGATCCATTACTCGATATGCTGATTCAGACGCCGTGGATTAAGGCCTCATCCGAACGGCAGACACAGATACACATGCCGAGCTCAGACTCTGCAAGGGGACTCGCCGATGAAGTCTCAATACTAGCCGTCAGGTGATTGAGAGCATGGGAATGCTAGTGATTCGACACTGTTCAGAGTCCATACTTCAACGGCGAGAGACGAGAGAAGGTTGCGGTCCTGAGATGCGGCTCGCTACCATTACATGTGTCTTGTCTTCAGGCACCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATCATCGCCGCTGAAAGACTCGCCGAAGTATTGCCAGAATGACCAGCATCAACATGGAACGACGGCACCACACGAGAGCCAGATGTTCCTAAGAGTGCCGAGCCACAATGGTGATAAGAGCCGTCGGCATGTAACTCAATTCTTACTGCGACTTACTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGGCTCTACACAATGACCGCACGTTGCAACCATTATTCAACACCTATGTTCCGTCCAGCCTCGCATGACGCCAGATAAGGTGTGCGGTTGCTCACCGGCTCACAGCAAGCACACCTTCATCTATCAGGCCGAAGGTCGATAAGCGGCTCAATTCACAGGACGGAGGCGGTCCCTAGATACTGTGTAGAACACGCAAGGATCACGGATCGGGACGTACCGTTGTACTAGCATACGCCGTCTGGAATATGGCGGCAGCTAAGTATCATGCCATGTTAGTAGCTTGGACGCCGTTACCAGCCTGATGCAATTATCGATATGCTGATTCAGACGCCGAGGCATTAAGGCCTCATCCGAACGGCAGACACAGATACACATGCCGGCTAAGACTCTGCAAGGAGACTCGCCGTTGAAGTCTCAATTACTGCCGTAGGTGATTAGAGCTGAGAAGCTCGTAGATTCGACAACTTGTATCAGAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGCGGTCTGAGATGCGGCTTGCTACGCATTACATGTGTCTTCTTCAGTGCACCTGCGCGGAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACTGGAATTAGTACGATACATCCGCCGCTGTAAGATCGCCGAAGTATTGCCGAATGAGCCAGGCATCAACATGGAACGCTACGCCACCACACGAGAGCCACAAGTTCCTGAGGAGTGCCGAGCCACAATGGTGAATAAGAGCCGTCGGATCGAAACTCAATTCTTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCGTACGACCACGCGCTCTACACCATGACCGCAACGTTGCAACCATTATTCAAGACCATATGTTCCGTCAGCCTCGCATGACGCCAGATAAGTGTGCGGTTGCTCACCGGCTCACAGCAAGCGCACCTTCATCGTATCGAGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGTACCTAGATACTGTGTAGAACATCGCAAGGATCACGAGATCTGACGTACCGTTAAGTACAAGATACGCCGTGCTGGAATATGGCGGCCAGCTAAGTCTGATGCCATGTTAGTATCTTGGACGCCGTTCCAGCCTGATGCATTATCGATATGCTGATTCAGACGCCTTGGATTAAGGCCTCATCCGACGCAGACACAGAGACACATGCCGGCTAAGATCTGCAAGGAGACTCGCCGAGGAAGTCTCAGTTACTGCGTGAGGTGATTGAGAGAATGAGGAAGCTCGTAATTCGACAACTTGTATCAGAGTCTATACTTCAACGGCGAGAGACGAGAAGGTTGCGGTCCTGAGATGCGGCTTGCTACATTACATGTGTCTTGCTTCAGGCACCTGCGACGCAATTACAATTCAA"));
    EXPECT_NO_THROW(reads.AddRead("GCGCTAACTGGAATTAGTACGATACATCCGCCGGCTGTAAGACTCGCGAAGTATTGCCGATATGACCAGCATCCACATGGAACGCTACCACAACACGAGAGCCAGAAGTTCCTGAGGAGTGCCGAGCCAAATGTGAATAAGAGCCGTCGGATTGGAACTCAATTCTTTCACTGCATCTTCTGTCAATGCGAGCCGTAGGCCGGCATACGACCACGCGCTCTAGCACCTATGACCGCACGTTGCAACCATTATTCAAGCCCTATGTTCCGTCCACCTCGCATCACGCCAGATAAGGTTTGCGGTTGCTCACCGGCTCAGAGCAAGGCACCTTCATCCATCGAGGCCGAAGGTCGATACTGCGGCTCAATTCACAGGACGGGGCGGTACCTAGAATTCTGTGTAGAACATCGCAAGGATCACGGATCTGACGTACTGATAGTACAGATACGCCGTGTGGAATGATGGCGCGCCAGCTAAGTCTCATGCCATGTCAGTATGCTTGGACGCCGTTACCAGCTGATGCATTATGCGCATAATGCTGATTCAGACGCCGTGGATAAGGCCTCATCCGAACGGCAGACCCAGATACACATGCCGGCTAAACTCTGCAAGGAGACTCGCCTTTCAAGTCTGAATTACTGCCGTCAGGTGATTGAGAGCATGAGGAAGCTCGTAGATTCGACACTTGTATCAGAGTCTATTCTTCAACGGCGAGAGACGAGAAGGTTGCGGTCCTGAGATACGGCTTGCTAGCATTACATGTGTCTTGCTTCAGGCTCTGCGCGCAATTACAATTCAAC"));
    EXPECT_NO_THROW(reads.AddRead("GCGGATAACGGAATTAGTAGATATATCCGCGCTGTAAGAGCTCGCCGAAGTATTGCCGAATGACCAGCATCAACATGGAATGCTACGCCACCACACAGAGAGCCCATAAGTTCCGAGGCAGTGCCGAGCCACACTGGTGAATAAGAGCCGTCGGATGCAACTCAATTCTTACTGCGACTTCTGTCAATGCGAGCCGTAGGCGGCATACGACCACGCGCTCTACACCTTGACCGCACCTTGCAACCATTATATCAAGTCTATGCTCCGTCCAGCCTCGCAGACGCCAGATCAAGGTGTGCGGTTGCTCACCTGCTCACAGCAGCGCACCTTATCTATCGTGGCCGAAGGTCGATATGCGGCTCAATTCACAGGACGGAGGCGGTAACTTAGATACTGTGTAGAACATCGCAAGGATCACGGATCGACGTACCGTTAGTACTAGATTACCCCGGTGGAATATGGCGGCCATGCTAAGTCTCAGCATTGTTAGTATGCTCGGACGCCGTTACCAGCCTGATGCATTATCGATATGCTGATTCAGACGCGTGGATTAAGGGCCTCATCCGCAACGGCCAGACACAGATACTCATGACGGCTAAGACTCCAAGGAGCTCGCGTTGAAGTCTCAATTACTGCCGTCAGGGTGAATTGAGAGCATGAGGAAGCTCGTAGATTCGACAACTTGTACAGAGTCTATACTTCAACGGCGCGAGACGAGAAGGGTTGCGGTCCTGAGATGCCGGCTTGCTAGAATCACATGTGTCTTGCTTCATGGCACCTACGGCGACAATTACAATTCAAC"));

    dataset.AddCluster(reads);
    cluster = dataset.GetView(0);

    EXPECT_EQ(cluster.Size(), 12);

    std::string centroid;

    for (size_t mtfIdx = 0; mtfIdx < 50; mtfIdx++) {
        auto consensus = cluster.GetConsensus(16, 4);
        EXPECT_EQ(consensus.GetMotif(), reference[mtfIdx]);
        cluster.AdjustReads(consensus.GetMotif(), 4);
    }
}


TEST(ClusterView, ConsensusShortStrings) {

    ClustersDataset dataset;
    Cluster reads;
    ClusterView cluster;

    EXPECT_NO_THROW(reads.AddRead("AGTACGATACATCCGC"));
    EXPECT_NO_THROW(reads.AddRead("TCGTACGATACATCGCCGG"));
    EXPECT_NO_THROW(reads.AddRead("AGTACTGATACATCCGCCG"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATACATCCGC"));
    EXPECT_NO_THROW(reads.AddRead("AGTCCGATACATCCGC"));
    EXPECT_NO_THROW(reads.AddRead("AGACGATACATCCGCC"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATACATCCGCCGC"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATACATCCGC"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATCATCGCCGCT"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATACATCCGC"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATACATCCGCCGG"));

    dataset.AddCluster(reads);
    cluster = dataset.GetView(0);

    EXPECT_EQ(cluster.Size(), 11);

    std::string centroid;

    auto consensus = cluster.GetConsensus(16, 4);
    EXPECT_EQ(consensus.GetMotif(), "AGTACGATACATCCGC");
    cluster.AdjustReads(consensus.GetMotif(), 4);
}

TEST(ClusterView, ConsensusLessThanOneMotif) {

    ClustersDataset dataset;
    Cluster reads;
    ClusterView cluster;

   // EXPECT_NO_THROW(reads.AddRead("AGTACGATACATCCGC"));
    EXPECT_NO_THROW(reads.AddRead("TCGTACGATAC"));
    EXPECT_NO_THROW(reads.AddRead("AGTACTGATACAT"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATA"));
    EXPECT_NO_THROW(reads.AddRead("A"));
    EXPECT_NO_THROW(reads.AddRead("AGACGATAC"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATACAT"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATAC"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATCA"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATACA"));
    EXPECT_NO_THROW(reads.AddRead("AGTACGATA"));

    dataset.AddCluster(reads);
    cluster = dataset.GetView(0);

    EXPECT_EQ(cluster.Size(), 10);

    std::string centroid;

    auto consensus = cluster.GetConsensus(16, 4);
    EXPECT_EQ(consensus.GetMotif(), "AGTACGATACAAAAAA");
    cluster.AdjustReads(consensus.GetMotif(), 4);
}

TEST(ClustersDataset, ImportClusterFormat) {
    {
        std::ofstream out_f("cluster.txt");
        out_f << 10 << std::endl;
        out_f << "AGTACGATACATCCGC" << std::endl;
        out_f << "TCGTACGATAC" << std::endl;
        out_f << "AGTACTGATACAT" << std::endl;
        out_f << "AGTACGATA" << std::endl;
        out_f << "A" << std::endl;
        out_f << "AGACGATAC" << std::endl;
        out_f << "AGTACGATACAT" << std::endl;
        out_f << "AGTACGATAC" << std::endl;
        out_f << "AGTACGATCA" << std::endl;
        out_f << "AGTACGATACA" << std::endl;

        out_f << 9 << std::endl;
        out_f << "AGTACGCGTACGATACATCCGC" << std::endl;
        out_f << "TCGTACGCATGACATAC" << std::endl;
        out_f << "AGTAGATACAT" << std::endl;
        out_f << "AGTATGCACGATA" << std::endl;
        out_f << "AGCTAGCT" << std::endl;
        out_f << "AGACACACGATAC" << std::endl;
        out_f << "AGTACGTTGAGCATACAT" << std::endl;
        out_f << "AGTACTGACGGATAC" << std::endl;
        out_f << "AGTAACTAGCCGATCA" << std::endl;
    }

    ClustersDataset dataset;
    std::uint32_t szMotif = 16;
    ClustersDataset::ImportClusters("cluster.txt", dataset, szMotif );

    EXPECT_EQ(dataset.Size(), 2);

    auto cluster = dataset.GetView(0);

    EXPECT_EQ(cluster.GetReadAt(0), "AGTACGATACATCCGC" );
    EXPECT_EQ(cluster.GetReadAt(1), "TCGTACGATACAAAAA" );
    EXPECT_EQ(cluster.GetReadAt(2), "AGTACTGATACATAAA" );
    EXPECT_EQ(cluster.GetReadAt(3), "AGTACGATAAAAAAAA" );
    EXPECT_EQ(cluster.GetReadAt(4), "AAAAAAAAAAAAAAAA" );
    EXPECT_EQ(cluster.GetReadAt(5), "AGACGATACAAAAAAA" );
    EXPECT_EQ(cluster.GetReadAt(6), "AGTACGATACATAAAA" );
    EXPECT_EQ(cluster.GetReadAt(7), "AGTACGATACAAAAAA" );
    EXPECT_EQ(cluster.GetReadAt(8), "AGTACGATCAAAAAAA" );
    EXPECT_EQ(cluster.GetReadAt(9), "AGTACGATACAAAAAA" );

    EXPECT_NE(cluster.GetReadAt(1), "TCGTACGATAC");

}

TEST(ClustersDataset, ImportFASTAFormat) {
    {
        std::ofstream out_f("cluster.txt");
        out_f << ">ref0" << std::endl;
        out_f << "AGTACGATACATCCGC" << std::endl;
        out_f << ">ref1" << std::endl;
        out_f << "TCGTACGATAC" << std::endl;
        out_f << ">ref2" << std::endl;
        out_f << "AGTACTGATACAT" << std::endl;
        out_f << ">ref3" << std::endl;
        out_f << "AGTACGATA" << std::endl;
        out_f << ">ref4" << std::endl;
        out_f << "A" << std::endl;
        out_f << ">ref5" << std::endl;
        out_f << "AGACGATAC" << std::endl;
        out_f << ">ref6" << std::endl;
        out_f << "AGTACGATACAT" << std::endl;
        out_f << ">ref7" << std::endl;
        out_f << "AGTACGATAC" << std::endl;
        out_f << ">ref8" << std::endl;
        out_f << "AGTACGATCA" << std::endl;
        out_f << ">ref9" << std::endl;
        out_f << "AGTACGATACA" << std::endl;
    }

    ClustersDataset dataset;
    std::uint32_t szMotif = 16;
    ClustersDataset::ImportClusters("cluster.txt", dataset, szMotif );

    EXPECT_EQ(dataset.Size(), 10);

    auto cluster = dataset.GetView(0);

    EXPECT_EQ(cluster.GetReadAt(0), "AGTACGATACATCCGC" );
    EXPECT_THROW(cluster.GetReadAt(1), index_not_available );
    EXPECT_THROW(cluster.GetReadAt(2), index_not_available );
    EXPECT_THROW(cluster.GetReadAt(3), index_not_available );

    cluster = dataset.GetView(5);
    EXPECT_EQ(cluster.GetReadAt(0), "AGACGATACAAAAAAA" );
}

TEST(ClustersDataset, ImportWrongFormat){
    {
        std::ofstream out_f("cluster.txt");
        out_f << -4 << std::endl;
        out_f << "AGTACGATACATCCGC" << std::endl;
        out_f << "TCGTACGATAC" << std::endl;
        out_f << "AGTACTGATACAT" << std::endl;
        out_f << "AGTACGATA" << std::endl;
    }
    ClustersDataset dataset;
    std::uint32_t szMotif = 16;
    EXPECT_THROW( ClustersDataset::ImportClusters("cluster.txt", dataset, szMotif ), invalid_cluster_format );
}

TEST(ClustersDataset, ImportWrongFormat2){
    {
        std::ofstream out_f("cluster.txt");
        out_f << "ref0" << std::endl;
        out_f << "AGTACGATACATCCGC" << std::endl;
        out_f << "TCGTACGATAC" << std::endl;
        out_f << "AGTACTGATACAT" << std::endl;
        out_f << "AGTACGATA" << std::endl;
    }
    ClustersDataset dataset;
    std::uint32_t szMotif = 16;
    EXPECT_THROW( ClustersDataset::ImportClusters("cluster.txt", dataset, szMotif ), invalid_cluster_file );
}

TEST(ClustersDataset, ImportWrongFormat3){
    {
        std::ofstream out_f("cluster.txt");
        out_f << 3 << std::endl;
        out_f << "AGTACGATACATCCGC" << std::endl;
        out_f << "TCGTACGATAC" << std::endl;
        out_f << "AGTACTGATACAT" << std::endl;
        out_f << "AGTACGATA" << std::endl;
    }
    ClustersDataset dataset;
    std::uint32_t szMotif = 16;
    EXPECT_THROW( ClustersDataset::ImportClusters("cluster.txt", dataset, szMotif ), invalid_cluster_format );
}